<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <title>ë‚ ì•„ë¼ ë©€ìº ëŸ¬</title>
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><circle cx="32" cy="32" r="28" fill="%23ff7a17"/></svg>'>
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root{
      --bg:#ffffff; --panel:#ffffff; --text:#0e1220; --accent:#ff7a17;
      --muted:#6b7280; --line:#e9edf3; --shadow:rgba(0,0,0,0.06);
      --logo: clamp(56px, 8vw, 96px);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Noto Sans KR", "ë§‘ì€ ê³ ë”•", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    body, button { touch-action: manipulation; user-select: none; -webkit-user-select: none; }
    #gameWrap{
      position:relative;width:100%;
      height:calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      padding-top:env(safe-area-inset-top); padding-bottom:env(safe-area-inset-bottom);
      overflow:hidden; background:var(--bg);
    }
    canvas{position:absolute;inset:0;width:100%;height:100%;display:block;background:#ffffff;}
    .mc-logo-img{
      position:absolute; left:12px; top: calc(env(safe-area-inset-top) + 10px);
      z-index:20; width:var(--logo); height:var(--logo); object-fit:contain; -webkit-user-drag:none; pointer-events:none;
    }
    .cornerHUD{
      position:absolute; left:12px; top:calc(var(--logo) + 24px);
      z-index:8; display:flex; flex-direction:column; gap:6px;
      background:rgba(255,255,255,0.88); padding:8px 10px; border-radius:10px; border:1px solid var(--line);
      backdrop-filter: blur(4px); font-weight:700;
    }
    .soundToggle{
      position:absolute; right:12px; top: calc(env(safe-area-inset-top) + 10px);
      z-index:20; background:rgba(255,255,255,0.88); border:1px solid var(--line); border-radius:999px;
      padding:6px 12px; font-weight:800; display:inline-flex; align-items:center; gap:8px; backdrop-filter: blur(4px);
    }
    .soundToggle button{ background:none; border:none; font:inherit; cursor:pointer; }
    .soundToggle .icon{font-size:18px}
    .overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,0.75); padding:clamp(12px, 3vw, 24px); z-index:6;
      -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    }
    .panel{
      width:min(760px,94vw); background:var(--panel); border:1px solid var(--line);
      border-radius:16px; padding:clamp(14px, 2.8vw, 22px); box-shadow:0 10px 24px var(--shadow);
    }
    .title{font-weight:800; font-size: clamp(20px, 5.2vw, 34px); line-height:1.2; margin:4px 0 8px;}
    .subtitle{color:var(--muted); margin:0 0 14px; font-size:clamp(12px, 3.4vw, 14px)}
    .grid{display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(56px, 1fr));}
    .charBtn{display:flex; align-items:center; justify-content:center; padding:clamp(10px, 3.2vw, 14px) 0;
      border-radius:12px; border:1px solid var(--line); background:#fff; cursor:pointer; transition: all .15s ease;
      user-select:none; box-shadow:0 2px 6px var(--shadow);}
    .charBtn img{width:clamp(28px, 6.4vw, 32px); height:clamp(28px, 6.4vw, 32px)}
    .charBtn[data-selected="true"]{outline:2px solid var(--accent); transform: translateY(-2px); background:#fff6ef;}
    .btn{appearance:none; border:1px solid var(--line); background:#fff; color:#0b1020;
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; transition:.15s;
      box-shadow:0 2px 6px var(--shadow); font-size:clamp(14px, 3.6vw, 16px);}
    .btn.primary{background:var(--accent); border-color:#ef6b05; color:#111;}
    .btn:active{transform: translateY(1px)}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" aria-label="ê²Œì„ ìº”ë²„ìŠ¤" role="img"></canvas>

    <img class="mc-logo-img" alt="multicampus"
         decoding="async" fetchpriority="high"
         src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267"/>

    <div class="soundToggle"><span class="icon" id="soundIcon">ğŸ”Š</span><button id="btnSound" aria-pressed="false">ì‚¬ìš´ë“œ ON</button></div>

    <div class="cornerHUD" id="hud" style="display:none">
      <span class="tag" id="hudDiff">ë‚œì´ë„: -</span>
      <span class="tag" id="hudChar">ìºë¦­í„°: -</span>
      <span>ì ìˆ˜ <b id="hudScore">0</b></span>
    </div>

    <!-- Start Screen -->
    <div class="overlay" id="startScreen" aria-modal="true">
      <div class="panel">
        <div class="title">ë‚ ì•„ë¼ ë©€ìº ëŸ¬!</div>
        <p class="subtitle">ë©€ë¦¬ ë‹¬ë ¤ë³´ì„¸ìš” ğŸš€</p>
        <div class="grid" id="charGrid"></div>
        <button class="btn primary" id="btnStart">ê²Œì„ ì‹œì‘</button>
      </div>
    </div>

    <!-- Game Over -->
    <div class="overlay" id="gameOverScreen" style="display:none" aria-modal="true">
      <div class="panel">
        <div class="title">ê²Œì„ ì¢…ë£Œ</div>
        <div><span id="finalScore">0</span> ì </div>
        <button class="btn" id="btnRetry">ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn" id="btnGoHome">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <script>
    // ===== ê³µí†µ ì„¸íŒ… =====
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d", { alpha: true, desynchronized: true });
    let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio || 1, 2);

    function applyCanvasSize() {
      const cw = Math.floor(canvas.clientWidth);
      const ch = Math.floor(canvas.clientHeight);
      W = cw; H = ch;
      canvas.width  = Math.max(1, Math.floor(cw * DPR));
      canvas.height = Math.max(1, Math.floor(ch * DPR));
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      ctx.textBaseline = "alphabetic";
    }
    new ResizeObserver(applyCanvasSize).observe(canvas);
    applyCanvasSize();

    // ===== ê²Œì„ ìƒíƒœ =====
    let running = false, score = 0;
    const startScreen  = document.getElementById("startScreen");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const finalScore = document.getElementById("finalScore");
    const hud = document.getElementById("hud");
    const hudScore = document.getElementById("hudScore");

    document.getElementById("btnStart").addEventListener("click", startGame, { passive: true });
    document.getElementById("btnRetry").addEventListener("click", startGame, { passive: true });
    document.getElementById("btnGoHome").addEventListener("click", () => {
      startScreen.style.display = "flex";
      gameOverScreen.style.display = "none";
    }, { passive: true });

    // ===== ìºë¦­í„°(ì´ëª¨ì§€) - ì˜¤ë¥¸ìª½ ë°”ë¼ë³´ë„ë¡ ìˆ˜í‰ ë°˜ì „ ê·¸ë¦¬ê¸° =====
    const EMOJI = "ğŸ–"; // ì¢Œí–¥ ê¸°ë³¸ ì´ëª¨ì§€
    const EMOJI_FONT = "28px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, emoji";
    const groundY = () => H - 50;
    const pig = { x: 100, y: 0 }; // yëŠ” ë² ì´ìŠ¤ë¼ì¸ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
    function drawEmojiFacingRight(text, x, y) {
      ctx.save();
      ctx.font = EMOJI_FONT;
      // ë¬¸ì í­ ì¸¡ì • í›„ ê·¸ í­ë§Œí¼ ì¢Œí‘œë¥¼ ë°€ê³  ì¢Œìš°ë°˜ì „
      const m = ctx.measureText(text);
      const w = Math.max(24, m.width);
      ctx.translate(x + w, 0);
      ctx.scale(-1, 1);
      ctx.fillText(text, 0, y);
      ctx.restore();
    }

    // ì í”„(ì˜µì…˜) â€“ ê°„ë‹¨í•œ ê°€ì†ë„
    let vy = 0, onGround = true;
    function jump(){
      if (!running) return;
      if (onGround){
        vy = -12; onGround = false;
      }
    }
    window.addEventListener("keydown", (e)=>{
      if (e.code === "Space" || e.code === "ArrowUp") { e.preventDefault(); jump(); }
    }, { passive:false });
    canvas.addEventListener("pointerdown", ()=> jump(), { passive:true });

    // ===== ì¥ì• ë¬¼ ì‹œìŠ¤í…œ =====
    const obstacles = [];
    let spawnTimer = 0;
    let baseSpeed = 3;

    function spawnObstacle() {
      const height = 30 + Math.random()*30;       // 30~60
      const width  = 24 + Math.random()*26;       // 24~50
      const gapTop = groundY() - height;          // ë°”ë‹¥ì—ì„œ ì„¸ìš´ ë§‰ëŒ€
      obstacles.push({
        x: W + 20,
        y: gapTop,
        w: width,
        h: height,
        color: "#ff7a17"
      });
    }

    function updateObstacles() {
      // ì†ë„ëŠ” ì ìˆ˜ì— ë”°ë¼ ì†Œí­ ì¦ê°€
      const speed = baseSpeed + Math.min(6, score/150);
      for (const o of obstacles) o.x -= speed;

      // í™”ë©´ ë°– ì œê±°
      for (let i=obstacles.length-1; i>=0; i--){
        if (obstacles[i].x + obstacles[i].w < -40) obstacles.splice(i,1);
      }

      // ì£¼ê¸°ì  ìƒì„±
      if (spawnTimer <= 0) {
        spawnObstacle();
        spawnTimer = 60 + Math.random()*50; // 1~1.8ì´ˆ ê°€ëŸ‰
      } else {
        spawnTimer--;
      }
    }

    function drawObstacles() {
      for (const o of obstacles) {
        // ì™¸ê³½ì„ ê³¼ ê·¸ë¦¼ìë¡œ ì‹œì¸ì„± ê°•í™”
        ctx.fillStyle = o.color;
        ctx.fillRect(o.x, o.y, o.w, o.h);
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#e35f00";
        ctx.strokeRect(o.x, o.y, o.w, o.h);
      }
    }

    function checkCollision() {
      // ìºë¦­í„° ëŒ€ëµì  íˆíŠ¸ë°•ìŠ¤ (ì´ëª¨ì§€ ì£¼ë³€ ì‚¬ê°í˜•)
      const box = { x: pig.x-8, y: pig.y-24, w: 28, h: 26 };
      for (const o of obstacles) {
        if (box.x < o.x + o.w && box.x + box.w > o.x &&
            box.y < o.y + o.h && box.y + box.h > o.y) {
          return true;
        }
      }
      return false;
    }

    // ===== ë£¨í”„ =====
    let rafId = null;

    function startGame(){
      cancelAnimationFrame(rafId);
      running = true; score = 0;
      obstacles.length = 0; spawnTimer = 0; baseSpeed = 3;
      pig.y = groundY() - 20; vy = 0; onGround = true;

      startScreen.style.display = "none";
      gameOverScreen.style.display = "none";
      hud.style.display = "flex";
      loop();
    }

    function endGame(){
      running = false;
      hud.style.display = "none";
      finalScore.textContent = score;
      gameOverScreen.style.display = "flex";
    }

    function loop(){
      if (!running) return;
      ctx.clearRect(0,0,W,H);

      // ë°”ë‹¥
      ctx.fillStyle = "#f0f0f0";
      ctx.fillRect(0, groundY(), W, 50);

      // ì¤‘ë ¥/ì í”„
      vy += 0.7;
      pig.y += vy;
      if (pig.y >= groundY() - 20) {
        pig.y = groundY() - 20;
        vy = 0; onGround = true;
      }

      // ì¥ì• ë¬¼ ì—…ë°ì´íŠ¸ & ë Œë”
      updateObstacles();
      drawObstacles();

      // ìºë¦­í„°(ì˜¤ë¥¸ìª½ ë°”ë¼ë³´ê²Œ ë°˜ì „)
      ctx.fillStyle = "#333";
      ctx.font = EMOJI_FONT;
      drawEmojiFacingRight(EMOJI, pig.x, pig.y);

      // ì¶©ëŒ ì²´í¬
      if (checkCollision()) {
        endGame();
        return;
      }

      // ì ìˆ˜
      score++;
      hudScore.textContent = score;

      rafId = requestAnimationFrame(loop);
    }

    // í˜ì´ì§€ ìˆ¨ê¹€ ì‹œ ë£¨í”„ ì •ë¦¬
    document.addEventListener("visibilitychange", () => {
      if (document.hidden && running) cancelAnimationFrame(rafId);
      else if (!document.hidden && running) rafId = requestAnimationFrame(loop);
    });

    // ìŠ¤í¬ë¡¤ ë°©ì§€
    document.addEventListener("touchmove", (e) => {
      if (e.target === canvas || e.target.closest("#gameWrap")) e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>