<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <title>날아라 멀캠러</title>
  <!-- 주황색 동그라미 파비콘 -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><circle cx="32" cy="32" r="28" fill="%23ff7a17"/></svg>'>
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --text:#0e1220;
      --accent:#ff7a17;
      --muted:#6b7280;
      --line:#e9edf3;
      --shadow:rgba(0,0,0,0.06);
      /* 로고: 작은 폰에선 56px, 큰 화면에선 최대 96px */
      --logo: clamp(56px, 8vw, 96px);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Noto Sans KR", "맑은 고딕", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    /* 모바일 UX 향상: 더블탭 확대/긴 눌림/텍스트 선택 방지 */
    body, button {
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }
    #gameWrap{
      position:relative;width:100%;
      height:calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      padding-top:env(safe-area-inset-top); padding-bottom:env(safe-area-inset-bottom);
      overflow:hidden; background:var(--bg);
    }
    canvas{
      position:absolute;inset:0;width:100%;height:100%;display:block;background:#ffffff;
      image-rendering: optimizeQuality;
    }

    /* 로고 이미지 */
    .mc-logo-img{
      position:absolute;
      left:12px;
      top: calc(env(safe-area-inset-top) + 10px);
      z-index:20;
      width:var(--logo);
      height:var(--logo);
      object-fit:contain;
      -webkit-user-drag:none;
      user-select:none;
      pointer-events:none;
    }

    /* HUD */
    .cornerHUD{
      position:absolute; left:12px; top:calc(var(--logo) + 24px);
      z-index:8; display:flex; flex-direction:column; gap:6px;
      background:rgba(255,255,255,0.88); padding:8px 10px; border-radius:10px; border:1px solid var(--line);
      backdrop-filter: blur(4px);
      font-weight:700;
    }

    /* 사운드 토글 */
    .soundToggle{
      position:absolute; right:12px; top: calc(env(safe-area-inset-top) + 10px);
      z-index:20; user-select:none;
      background:rgba(255,255,255,0.88); border:1px solid var(--line); border-radius:999px;
      padding:6px 12px; font-weight:800; display:inline-flex; align-items:center; gap:8px;
      backdrop-filter: blur(4px);
    }
    .soundToggle button{ background:none; border:none; font:inherit; cursor:pointer; }
    .soundToggle .icon{font-size:18px}

    /* 오버레이 / 패널 */
    .overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,0.75);
      padding:clamp(12px, 3vw, 24px); z-index:6;
      -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    }
    .panel{
      width:min(760px,94vw);
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:clamp(14px, 2.8vw, 22px);
      box-shadow:0 10px 24px var(--shadow);
    }
    .title{font-weight:800; font-size: clamp(20px, 5.2vw, 34px); line-height:1.2; margin:4px 0 8px;}
    .subtitle{color:var(--muted); margin:0 0 14px; font-size:clamp(12px, 3.4vw, 14px)}
    .grid{display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(56px, 1fr));}
    .charBtn{display:flex; align-items:center; justify-content:center;
      padding:clamp(10px, 3.2vw, 14px) 0;
      border-radius:12px; border:1px solid var(--line);
      background:#fff; cursor:pointer; transition: all .15s ease;
      user-select:none; box-shadow:0 2px 6px var(--shadow);}
    .charBtn img{width:clamp(28px, 6.4vw, 32px); height:clamp(28px, 6.4vw, 32px)}
    .charBtn[data-selected="true"]{outline:2px solid var(--accent); transform: translateY(-2px); background:#fff6ef;}
    .btn{appearance:none; border:1px solid var(--line); background:#fff; color:#0b1020;
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; transition:.15s;
      box-shadow:0 2px 6px var(--shadow); font-size:clamp(14px, 3.6vw, 16px);}
    .btn.primary{background:var(--accent); border-color:#ef6b05; color:#111;}
    .btn:active{transform: translateY(1px)}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" aria-label="게임 캔버스" role="img"></canvas>

    <!-- 로고: 반응형 크기 -->
    <img class="mc-logo-img" alt="multicampus"
         decoding="async" fetchpriority="high" referrerpolicy="no-referrer"
         src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267"/>

    <div class="soundToggle"><span class="icon" id="soundIcon">🔊</span><button id="btnSound" aria-pressed="false">사운드 ON</button></div>

    <!-- HUD -->
    <div class="cornerHUD" id="hud" style="display:none">
      <span class="tag" id="hudDiff">난이도: -</span>
      <span class="tag" id="hudChar">캐릭터: -</span>
      <span>점수 <b id="hudScore">0</b></span>
    </div>

    <!-- Start Screen -->
    <div class="overlay" id="startScreen" aria-modal="true">
      <div class="panel">
        <div class="title">날아라 멀캠러!</div>
        <p class="subtitle">멀리 달려보세요 🚀</p>
        <div class="grid" id="charGrid"></div>
        <button class="btn primary" id="btnStart">게임 시작</button>
      </div>
    </div>

    <!-- Game Over -->
    <div class="overlay" id="gameOverScreen" style="display:none" aria-modal="true">
      <div class="panel">
        <div class="title">게임 종료</div>
        <div><span id="finalScore">0</span> 점</div>
        <button class="btn" id="btnRetry">다시 하기</button>
        <button class="btn" id="btnGoHome">처음으로</button>
      </div>
    </div>
  </div>

  <script>
    // ====== 캔버스 초기화 및 리사이즈 ======
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d", { alpha: true, desynchronized: true });
    let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio || 1, 2); // 메모리/성능 위해 최대 2로 캡

    function applyCanvasSize() {
      // CSS 픽셀 기준 사이즈
      const cw = Math.floor(canvas.clientWidth);
      const ch = Math.floor(canvas.clientHeight);
      W = cw; H = ch;

      // 실 픽셀 해상도 적용
      canvas.width  = Math.max(1, Math.floor(cw * DPR));
      canvas.height = Math.max(1, Math.floor(ch * DPR));
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

      // 텍스트/선 두께 재설정 (리사이즈 후 필요)
      ctx.font = "16px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, 'Noto Sans KR', '맑은 고딕', sans-serif";
      ctx.textBaseline = "alphabetic";
    }

    // ResizeObserver로 레이아웃 변동에도 안정적으로 반응
    const ro = new ResizeObserver(applyCanvasSize);
    ro.observe(canvas);
    // 초기 설정
    applyCanvasSize();

    // ====== 게임 상태 ======
    let running = false, score = 0;
    const startScreen  = document.getElementById("startScreen");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const finalScore = document.getElementById("finalScore");
    const hud = document.getElementById("hud");
    const hudScore = document.getElementById("hudScore");

    document.getElementById("btnStart").addEventListener("click", startGame, { passive: true });
    document.getElementById("btnRetry").addEventListener("click", startGame, { passive: true });
    document.getElementById("btnGoHome").addEventListener("click", () => {
      startScreen.style.display = "flex";
      gameOverScreen.style.display = "none";
    }, { passive: true });

    // iOS Safari 오디오 정책 대응 샘플 (실 오디오가 있다면 이 자리에서 play() 시도)
    const btnSound = document.getElementById("btnSound");
    const soundIcon = document.getElementById("soundIcon");
    let soundOn = true;
    btnSound.addEventListener("click", () => {
      soundOn = !soundOn;
      btnSound.textContent = soundOn ? "사운드 ON" : "사운드 OFF";
      btnSound.setAttribute("aria-pressed", String(soundOn));
      soundIcon.textContent = soundOn ? "🔊" : "🔇";
      // 예: bgm?.[soundOn ? "play" : "pause"]?.();
    }, { passive: true });

    // 스크롤/바운스 방지 (iOS)
    document.addEventListener("touchmove", (e) => {
      if (e.target === canvas || e.target.closest("#gameWrap")) e.preventDefault();
    }, { passive: false });

    // ====== 데모 게임 루프 ======
    let rafId = null;

    function startGame(){
      cancelAnimationFrame(rafId);
      running = true; score = 0;
      startScreen.style.display = "none";
      gameOverScreen.style.display = "none";
      hud.style.display = "flex";
      loop();
    }

    function endGame(){
      running = false;
      hud.style.display = "none";
      finalScore.textContent = score;
      gameOverScreen.style.display = "flex";
    }

    function loop(){
      if (!running) return;

      // 배경
      ctx.clearRect(0, 0, W, H);
      // 바닥
      ctx.fillStyle = "#f0f0f0";
      ctx.fillRect(0, H - 50, W, 50);

      // 캐릭터(이모지) - 시스템 이모지 모양은 OS마다 다를 수 있음
      ctx.fillStyle = "#333";
      ctx.font = "24px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, emoji";
      ctx.fillText("🐖", 100, H - 70);

      // 점수 증가
      score++;
      hudScore.textContent = score;

      if (score > 300) {
        endGame();
      } else {
        rafId = requestAnimationFrame(loop);
      }
    }

    // 페이지 숨김 시 루프 정리(선택)
    document.addEventListener("visibilitychange", () => {
      if (document.hidden && running) {
        cancelAnimationFrame(rafId);
      } else if (!document.hidden && running) {
        rafId = requestAnimationFrame(loop);
      }
    });
  </script>
</body>
</html>